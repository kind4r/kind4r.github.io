<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chiri - Windows XP Resume</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- Reset & Base --- */
        * {
            box-sizing: border-box;
            user-select: none; /* Prevent text selection while dragging */
        }
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Tahoma', 'Segoe UI', sans-serif;
            font-size: 12px;
        }

        /* --- Variables --- */
        :root {
            --xp-blue: #245DDA;
            --xp-blue-grad-top: #0058EE;
            --xp-blue-grad-bot: #3A6EA5;
            --title-grad-top: #3081e4;
            --title-grad-bot: #0a34a0;
            --win-bg: #ECE9D8;
            --taskbar-height: 30px;
        }

        /* --- Desktop Wallpaper (CSS Bliss) --- */
        #desktop {
            width: 100%;
            height: calc(100% - var(--taskbar-height));
            position: relative;
            background: linear-gradient(to bottom, #3d94f6 0%, #b3dced 80%, #4e8306 80%, #2d4d03 100%);
            overflow: hidden;
        }
        /* Cloud effect (simple) */
        #desktop::before {
            content: '';
            position: absolute;
            top: 10%;
            left: 10%;
            width: 150px;
            height: 60px;
            background: rgba(255,255,255,0.4);
            border-radius: 50px;
            filter: blur(20px);
            animation: floatCloud 60s linear infinite;
        }
        @keyframes floatCloud {
            from { transform: translateX(-200px); }
            to { transform: translateX(120vw); }
        }

        /* --- Icons --- */
        .desktop-icons {
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            height: 100%;
            width: fit-content;
            padding: 10px;
            align-content: flex-start;
            gap: 20px;
        }

        .icon {
            width: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            color: white;
            text-shadow: 1px 1px 2px black;
            transition: all 0.1s;
            text-align: center;
        }

        .icon:hover {
            opacity: 0.8;
        }

        .icon:active .icon-img {
            filter: brightness(0.7);
        }

        .icon-img {
            width: 48px;
            height: 48px;
            margin-bottom: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
        }
        
        /* Specific Icon Colors */
        .icon-profile { color: #5eb6f6; }
        .icon-exp { color: #fff; text-shadow: 0 0 2px #000; }
        .icon-skills { color: #e67e22; }
        .icon-projects { color: #f1c40f; }
        .icon-contact { color: #2ecc71; }
        .icon-browser { color: #3498db; }
        .icon-trash { color: #95a5a6; }
        .icon-doom { color: #c0392b; text-shadow: 0 0 5px red; }

        .icon-label {
            font-size: 11px;
            line-height: 1.2;
            padding: 0 2px;
            background: rgba(0,0,0,0); /* Transparent by default */
            border-radius: 2px;
        }
        
        .icon.selected .icon-label {
            background: #0b61ff;
            border: 1px dotted #fff;
        }
        
        .icon.selected .icon-img {
            opacity: 0.8;
        }

        /* --- Windows --- */
        .window {
            position: absolute;
            background-color: var(--win-bg);
            border: 1px solid #0055ea;
            border-radius: 8px 8px 0 0;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            min-width: 200px;
            min-height: 150px;
            /* Default dimensions, overwritten by inline styles */
            width: 500px; 
            height: 400px;
            top: 50px;
            left: 50px;
            transition: transform 0.1s, opacity 0.1s;
        }

        .window.minimized {
            transform: scale(0);
            opacity: 0;
            pointer-events: none;
        }
        
        .window.maximized {
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: calc(100% - var(--taskbar-height)) !important;
            border-radius: 0;
        }

        .title-bar {
            height: 30px;
            background: linear-gradient(to bottom, var(--title-grad-top), var(--title-grad-bot));
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            border-radius: 6px 6px 0 0;
            font-weight: bold;
            text-shadow: 1px 1px #000;
            cursor: default;
        }

        .window.active .title-bar {
            background: linear-gradient(to bottom, var(--title-grad-top), var(--title-grad-bot));
        }
        
        /* Inactive window state */
        .window:not(.active) .title-bar {
            background: linear-gradient(to bottom, #7697ce, #5d7db0);
            color: #d6dbe9;
        }

        .title-text {
            display: flex;
            align-items: center;
            gap: 8px;
            pointer-events: none;
        }

        .title-controls {
            display: flex;
            gap: 4px;
        }

        .control-btn {
            width: 22px;
            height: 22px;
            border: 1px solid #fff;
            border-radius: 3px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            cursor: pointer;
            box-shadow: inset 0 0 2px rgba(0,0,0,0.5);
        }

        .btn-min { background: linear-gradient(#fff, #b6bccc); color: black; font-weight: bold; padding-bottom: 5px; }
        .btn-max { background: linear-gradient(#fff, #b6bccc); color: black; }
        .btn-close { background: linear-gradient(#ff8a79, #e83820); color: white; border-color: #a02211; font-size: 14px;}
        .btn-close:hover { background: linear-gradient(#ffad9f, #ff5438); }

        .window-menu-bar {
            background: #ECE9D8;
            border-bottom: 1px solid #D4D0C8;
            padding: 2px 5px;
            display: flex;
            gap: 10px;
            font-size: 11px;
        }
        
        .menu-item { cursor: pointer; }
        .menu-item:hover { background-color: #316ac5; color: white; }

        .window-body {
            flex: 1;
            background: white;
            border: 1px solid #999;
            margin: 3px;
            overflow: auto;
            position: relative;
            user-select: text;
            padding: 15px;
        }

        /* --- Game Styles --- */
        .doom-container {
            width: 100%;
            height: 100%;
            background: black;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        canvas#doom-canvas {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
        }
        .doom-overlay {
            position: absolute;
            bottom: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            pointer-events: none;
        }
        .doom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: grid;
            grid-template-columns: 50px 50px 50px;
            gap: 5px;
            pointer-events: auto;
            opacity: 0.6;
        }
        .doom-btn {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.3);
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 20px;
        }
        .doom-btn:active { background: rgba(255,255,255,0.6); }
        .doom-fire {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 80px;
            height: 80px;
            background: rgba(255,0,0,0.3);
            border: 2px solid red;
            border-radius: 50%;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            opacity: 0.6;
        }

        /* --- Content Styles --- */
        h1, h2, h3 { margin-top: 0; color: #333; }
        h2 { border-bottom: 1px solid #ccc; padding-bottom: 5px; font-size: 1.4em; color: #0044cc; }
        p { line-height: 1.5; color: #333; }
        ul { padding-left: 20px; }
        li { margin-bottom: 5px; }

        .profile-header { display: flex; gap: 20px; align-items: center; margin-bottom: 20px; }
        .profile-pic { width: 100px; height: 100px; background: #ddd; border: 2px solid #999; display: flex; align-items: center; justify-content: center; font-size: 40px; color: #666; }
        
        .exp-item { margin-bottom: 20px; border-left: 3px solid #245DDA; padding-left: 10px; }
        .exp-date { color: #666; font-size: 0.9em; font-style: italic; }
        .exp-title { font-weight: bold; font-size: 1.1em; }
        
        .skill-bar-container { margin-bottom: 10px; }
        .skill-label { display: flex; justify-content: space-between; margin-bottom: 2px; font-weight: bold; }
        .skill-bar-bg { background: #ddd; height: 15px; border: 1px solid #999; }
        .skill-bar-fill { height: 100%; background: linear-gradient(to right, #245DDA, #5cabff); width: 0; transition: width 1s ease-out; }
        
        .project-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px; }
        .project-folder { display: flex; flex-direction: column; align-items: center; cursor: pointer; text-align: center;}
        .project-folder i { font-size: 32px; color: #f1c40f; margin-bottom: 5px; }
        .project-folder:hover span { background: #0b61ff; color: white; }

        .contact-form { display: flex; flex-direction: column; gap: 10px; max-width: 400px; }
        .form-group label { display: block; margin-bottom: 3px; }
        .form-group input, .form-group textarea { width: 100%; padding: 5px; border: 1px solid #7f9db9; font-family: inherit; }
        .btn-submit { padding: 5px 15px; background: #ECE9D8; border: 1px solid #999; cursor: pointer; width: fit-content; }
        .btn-submit:active { transform: translateY(1px); }

        /* --- Taskbar --- */
        #taskbar {
            height: var(--taskbar-height);
            width: 100%;
            background: linear-gradient(to bottom, #245DDA 0%, #245DDA 10%, #1941A5 50%, #1941A5 100%);
            position: absolute;
            bottom: 0;
            left: 0;
            display: flex;
            align-items: center;
            padding: 0;
            z-index: 10000;
            border-top: 1px solid rgba(255,255,255,0.3);
        }

        #start-button {
            height: 100%;
            width: 100px;
            background: linear-gradient(to bottom, #3E852F 0%, #337224 100%);
            border-radius: 0 10px 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            font-weight: bold;
            color: white;
            font-size: 16px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            cursor: pointer;
            box-shadow: inset 0 5px 10px rgba(255,255,255,0.3), 2px 0 5px rgba(0,0,0,0.3);
            position: relative;
            margin-right: 10px;
        }
        
        #start-button:hover { filter: brightness(1.1); }
        #start-button:active { filter: brightness(0.9); box-shadow: inset 0 2px 5px rgba(0,0,0,0.5); transform: translateY(1px); }
        #start-button i { margin-right: 5px; font-style: normal; border: 1px solid white; border-radius: 50%; padding: 2px; font-size: 10px; }

        #task-list {
            display: flex;
            gap: 5px;
            flex: 1;
            padding-right: 10px;
            overflow: hidden;
        }

        .task-item {
            width: 150px;
            height: 24px;
            background-color: #3c81f3;
            border-radius: 3px;
            display: flex;
            align-items: center;
            padding: 0 8px;
            color: white;
            cursor: pointer;
            box-shadow: inset 0 5px 10px rgba(255,255,255,0.2);
            transition: background 0.2s;
        }
        .task-item:hover { background-color: #5291f5; }
        .task-item.active { background-color: #1e52b7; box-shadow: inset 0 2px 5px rgba(0,0,0,0.4); }
        .task-item i { margin-right: 6px; }
        .task-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        #tray {
            width: 80px;
            height: 100%;
            background-color: #1290E9;
            border-left: 1px solid rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2);
            padding: 0 10px;
        }

        /* --- Start Menu --- */
        #start-menu {
            position: absolute;
            bottom: var(--taskbar-height);
            left: 0;
            width: 250px;
            background: white;
            border: 1px solid #0046ff;
            border-top-right-radius: 10px;
            border-top-left-radius: 10px;
            box-shadow: 2px -2px 10px rgba(0,0,0,0.3);
            display: none;
            z-index: 9999;
            flex-direction: column;
        }
        #start-menu.open { display: flex; }

        .start-header {
            background: linear-gradient(to bottom, #245DDA, #1941A5);
            padding: 10px;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }
        .start-header i { font-size: 24px; margin-right: 10px; border: 2px solid white; border-radius: 50%; padding: 5px; }

        .start-body {
            display: flex;
            height: 300px;
        }
        .start-left {
            width: 50%;
            background: white;
            padding: 5px;
            border-right: 1px solid #ccc;
        }
        .start-right {
            width: 50%;
            background: #d3e5fa;
            padding: 5px;
            border-left: 1px solid #fff;
        }
        
        .start-item {
            display: flex;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            color: #333;
            margin-bottom: 2px;
        }
        .start-item:hover { background-color: #2f71cd; color: white; }
        .start-item i { margin-right: 8px; width: 20px; text-align: center; }
        
        .start-footer {
            background: linear-gradient(to bottom, #4886dd, #245DDA);
            padding: 8px;
            display: flex;
            justify-content: flex-end;
            color: white;
        }
        .shutdown-btn {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .shutdown-btn:hover { opacity: 0.8; }

        /* --- BSOD --- */
        #bsod {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000088;
            color: white;
            z-index: 99999;
            font-family: 'Courier New', Courier, monospace;
            padding: 50px;
            font-size: 16px;
        }

        @media (max-width: 600px) {
            .window { width: 90% !important; left: 5% !important; height: 70% !important; }
            #task-list { overflow-x: auto; }
            .task-item { min-width: 40px; width: 40px; justify-content: center; padding: 0; }
            .task-text { display: none; }
            .task-item i { margin: 0; }
        }
    </style>
</head>
<body>

    <!-- Desktop Area -->
    <div id="desktop">
        <div class="desktop-icons">
            <!-- Icons generated by JS -->
        </div>

        <!-- Windows container -->
        <div id="windows-container"></div>
    </div>

    <!-- Start Menu -->
    <div id="start-menu">
        <div class="start-header">
            <i class="fas fa-user-astronaut"></i>
            <span>Chiri</span>
        </div>
        <div class="start-body">
            <div class="start-left">
                <div class="start-item" onclick="openProgram('profile')">
                    <i class="fas fa-user icon-profile"></i>
                    <span class="bold">My Profile</span>
                </div>
                <div class="start-item" onclick="openProgram('experience')">
                    <i class="fas fa-file-word icon-exp" style="color: #2b579a;"></i>
                    <span>Experience</span>
                </div>
                 <div class="start-item" onclick="openProgram('browser')">
                    <i class="fas fa-globe icon-browser"></i>
                    <span>Internet</span>
                </div>
            </div>
            <div class="start-right">
                <div class="start-item" onclick="openProgram('contact')">
                    <i class="fas fa-envelope icon-contact"></i>
                    <span>My Email</span>
                </div>
                 <div class="start-item" onclick="openProgram('projects')">
                    <i class="fas fa-folder icon-projects"></i>
                    <span>My Projects</span>
                </div>
                <div class="start-item" onclick="openProgram('doom')">
                    <i class="fas fa-biohazard" style="color:red;"></i>
                    <span>DOOM.EXE</span>
                </div>
            </div>
        </div>
        <div class="start-footer">
            <div class="shutdown-btn" onclick="triggerShutdown()">
                <i class="fas fa-power-off" style="margin-right:5px; color:orange; background:white; border-radius:2px; padding:2px;"></i>
                <span>Turn Off Computer</span>
            </div>
        </div>
    </div>

    <!-- Taskbar -->
    <div id="taskbar">
        <div id="start-button" onclick="toggleStartMenu()">
            <i class="fab fa-windows"></i>
            Start
        </div>
        <div id="task-list">
            <!-- Task items go here -->
        </div>
        <div id="tray">
            <span id="clock">12:00 PM</span>
        </div>
    </div>

    <!-- Blue Screen of Death -->
    <div id="bsod">
        <p>A problem has been detected and windows has been shut down to prevent damage to your computer.</p>
        <p>RESUME_KERNEL_ERROR</p>
        <p>If this is the first time you've seen this stop error screen, restart your computer. If this screen appears again, follow these steps:</p>
        <p>Check to be sure you have adequate hiring budget. If a driver is identified in the stop message, disable the driver or check with the manufacturer for driver updates. Try changing video adapters.</p>
        <br>
        <p>Technical Information:</p>
        <p>*** STOP: 0x0000001E (0xC0000005, 0xF74D339E, 0x00000000, 0x00000000)</p>
        <br>
        <p style="animation: blink 1s infinite;">Press F5 to Reload...</p>
    </div>

<script>
    /* --- Data --- */
    const programs = {
        'profile': {
            title: 'My Profile',
            icon: 'fa-user',
            color: '#5eb6f6',
            content: `
                <div class="profile-header">
                    <div class="profile-pic"><i class="fas fa-user"></i></div>
                    <div>
                        <h1>Chiri</h1>
                        <p>Full Stack Developer | Creative Coder</p>
                        <p>Location: Cyberspace</p>
                    </div>
                </div>
                <h2>About Me</h2>
                <p>Welcome to my interactive resume! I am a passionate developer with a love for retro aesthetics and modern web technologies. This portfolio is a tribute to the OS that many of us grew up with.</p>
                <p>I specialize in building scalable web applications, creating intuitive user interfaces, and solving complex problems with clean code.</p>
                <h2>Summary</h2>
                <ul>
                    <li>5+ years of experience in Full Stack Development.</li>
                    <li>Proficient in JavaScript, React, Node.js, and Python.</li>
                    <li>Strong background in UI/UX design principles.</li>
                    <li>Excellent communicator and team player.</li>
                </ul>
            `
        },
        'experience': {
            title: 'Experience.doc',
            icon: 'fa-file-word',
            color: '#2b579a',
            content: `
                <div style="padding: 20px; background: white; min-height: 100%;">
                    <h1 style="color: #2b579a; text-align: center;">Curriculum Vitae</h1>
                    <hr>
                    <div class="exp-item">
                        <div class="exp-title">Senior Web Developer</div>
                        <div class="exp-company">Tech Solutions Inc.</div>
                        <div class="exp-date">2021 - Present</div>
                        <p>Leading a team of developers in building enterprise-level web applications. Implemented CI/CD pipelines, improved site performance by 40%, and mentored junior developers.</p>
                        <ul>
                            <li>Architected microservices using Node.js.</li>
                            <li>Refactored legacy codebase to React.</li>
                        </ul>
                    </div>
                    <div class="exp-item">
                        <div class="exp-title">Web Developer</div>
                        <div class="exp-company">Creative Agency XYZ</div>
                        <div class="exp-date">2018 - 2021</div>
                        <p>Developed custom websites for diverse clients. Collaborated with designers to translate wireframes into responsive, interactive web pages.</p>
                    </div>
                     <div class="exp-item">
                        <div class="exp-title">Junior Developer</div>
                        <div class="exp-company">Startup Hub</div>
                        <div class="exp-date">2016 - 2018</div>
                        <p>Assisted in backend development and database management. Fixed bugs and wrote unit tests.</p>
                    </div>
                </div>
            `
        },
        'skills': {
            title: 'Skills.exe',
            icon: 'fa-microchip',
            color: '#e67e22',
            content: `
                <h2>Technical Skills</h2>
                <p>Initializing skill analysis...</p>
                <div style="margin-top: 20px;">
                    ${createSkillBar('JavaScript / TypeScript', 95)}
                    ${createSkillBar('React / React Native', 90)}
                    ${createSkillBar('HTML5 / CSS3', 95)}
                    ${createSkillBar('Node.js / Express', 85)}
                    ${createSkillBar('Python / Django', 80)}
                    ${createSkillBar('SQL / NoSQL', 75)}
                    ${createSkillBar('DevOps (Docker, AWS)', 70)}
                </div>
            `
        },
        'projects': {
            title: 'My Projects',
            icon: 'fa-folder-open',
            color: '#f1c40f',
            content: `
                <h2>C:\\Users\\Chiri\\Projects</h2>
                <p>Select a project to view details (Mock file system):</p>
                <div class="project-grid">
                    <div class="project-folder" onclick="alert('Opening Project: E-Commerce Platform...\\nThis was a full stack MERN app.')">
                        <i class="fas fa-folder"></i>
                        <span>ShopApp</span>
                    </div>
                    <div class="project-folder" onclick="alert('Opening Project: AI Chatbot...\\nBuilt with Python and TensorFlow.')">
                        <i class="fas fa-folder"></i>
                        <span>AIChat</span>
                    </div>
                    <div class="project-folder" onclick="alert('Opening Project: Portfolio v1...\\nStatic HTML/CSS site.')">
                        <i class="fas fa-folder"></i>
                        <span>OldPort</span>
                    </div>
                     <div class="project-folder" onclick="alert('Opening Project: Task Manager...\\nReact + Firebase application.')">
                        <i class="fas fa-folder"></i>
                        <span>TaskMgr</span>
                    </div>
                </div>
            `
        },
        'contact': {
            title: 'Contact Me',
            icon: 'fa-envelope',
            color: '#2ecc71',
            content: `
                <h2>Compose New Message</h2>
                <div class="contact-form">
                    <div class="form-group">
                        <label>To: Chiri</label>
                        <input type="text" value="Chiri@example.com" disabled>
                    </div>
                     <div class="form-group">
                        <label>From:</label>
                        <input type="text" placeholder="Your Email">
                    </div>
                    <div class="form-group">
                        <label>Subject:</label>
                        <input type="text" placeholder="Hiring Inquiry">
                    </div>
                    <div class="form-group">
                        <label>Message:</label>
                        <textarea rows="8" placeholder="Hello Chiri, I loved your portfolio..."></textarea>
                    </div>
                    <button class="btn-submit" onclick="alert('Error: SMTP server not found.\\nJust kidding! This is a demo. Please email me at Chiri@example.com')">Send</button>
                </div>
            `
        },
        'browser': {
            title: 'Internet Explorer 6',
            icon: 'fa-globe',
            color: '#3498db',
            content: `
               <div style="display:flex; flex-direction:column; height:100%;">
                    <div style="background:#ECE9D8; padding:5px; border-bottom:1px solid #ccc; display:flex; gap:5px;">
                        <button disabled>Back</button>
                        <button disabled>Forward</button>
                        <input type="text" value="http://www.github.com/Chiri" style="flex:1;">
                        <button>Go</button>
                    </div>
                    <div style="flex:1; background:white; padding:20px; text-align:center;">
                        <h3>Page Cannot Be Displayed</h3>
                        <p>Just kidding. Here are my social links:</p>
                        <br>
                        <p><a href="#" style="color:blue; text-decoration:underline;">GitHub Profile</a></p>
                        <p><a href="#" style="color:blue; text-decoration:underline;">LinkedIn Profile</a></p>
                        <p><a href="#" style="color:blue; text-decoration:underline;">Twitter / X</a></p>
                    </div>
               </div>
            `
        },
        'doom': {
            title: 'DOOM.EXE',
            icon: 'fa-biohazard',
            color: '#c0392b',
            content: `
                <div class="doom-container" style="background:#222;">
                    <canvas id="doom-canvas"></canvas>
                    <div class="doom-overlay">
                        <!-- Gun rendered by canvas or CSS? Let's use CSS for simple HUD -->
                    </div>
                    <!-- Mobile Controls -->
                    <div class="doom-fire" id="doom-fire-btn">FIRE</div>
                    <div class="doom-controls">
                        <div></div>
                        <div class="doom-btn" id="doom-up">▲</div>
                        <div></div>
                        <div class="doom-btn" id="doom-left">◄</div>
                        <div class="doom-btn" id="doom-down">▼</div>
                        <div class="doom-btn" id="doom-right">►</div>
                    </div>
                </div>
            `
        },
        'recycle': {
            title: 'Recycle Bin',
            icon: 'fa-trash-alt',
            color: '#95a5a6',
            content: `
                <h2>Recycle Bin</h2>
                <p>The Recycle Bin is empty.</p>
            `
        }
    };

    function createSkillBar(name, percent) {
        // Initial width 0 for animation
        setTimeout(() => {
            const bars = document.querySelectorAll('.skill-bar-fill');
            bars.forEach(bar => {
                const target = bar.getAttribute('data-width');
                bar.style.width = target + '%';
            });
        }, 500);
        
        return `
            <div class="skill-bar-container">
                <div class="skill-label">
                    <span>${name}</span>
                    <span>${percent}%</span>
                </div>
                <div class="skill-bar-bg">
                    <div class="skill-bar-fill" data-width="${percent}" style="width: 0%;"></div>
                </div>
            </div>
        `;
    }

    /* --- System State --- */
    let highestZ = 100;
    let windowOffset = 0;
    const openWindows = {}; // Map of id -> DOM element

    /* --- Init --- */
    function initDesktop() {
        const desktop = document.querySelector('.desktop-icons');
        
        // Define order
        const iconKeys = ['profile', 'experience', 'skills', 'projects', 'contact', 'doom', 'browser', 'recycle'];
        
        iconKeys.forEach(key => {
            const prog = programs[key];
            const iconDiv = document.createElement('div');
            iconDiv.className = 'icon';
            if(key === 'doom') iconDiv.classList.add('icon-doom-wrapper'); 
            
            iconDiv.onclick = () => {
                // visual selection
                document.querySelectorAll('.icon').forEach(i => i.classList.remove('selected'));
                iconDiv.classList.add('selected');
            };
            iconDiv.ondblclick = () => openProgram(key);
            
            // Mobile single click support
            let tapCount = 0;
            iconDiv.addEventListener('touchstart', (e) => {
                tapCount++;
                if(tapCount === 1) {
                    setTimeout(() => tapCount = 0, 400);
                } else if (tapCount === 2) {
                     openProgram(key);
                     tapCount = 0;
                }
            });

            let iconColor = prog.color || 'white';
            let iconClass = 'icon-img';
            if(key === 'doom') iconClass += ' icon-doom';

            iconDiv.innerHTML = `
                <div class="${iconClass}" style="color:${iconColor}">
                    <i class="fas ${prog.icon}"></i>
                </div>
                <div class="icon-label">${prog.title}</div>
            `;
            desktop.appendChild(iconDiv);
        });

        // Clock
        updateClock();
        setInterval(updateClock, 1000);
        
        // Close start menu on desktop click
        document.getElementById('desktop').addEventListener('click', (e) => {
            if(e.target.id === 'desktop' || e.target.classList.contains('desktop-icons')) {
                document.getElementById('start-menu').classList.remove('open');
                document.querySelectorAll('.icon').forEach(i => i.classList.remove('selected'));
            }
        });
        
        // Initial Welcome Window
        openProgram('profile');
    }

    function updateClock() {
        const now = new Date();
        let hours = now.getHours();
        const minutes = now.getMinutes();
        const ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12;
        const strTime = hours + ':' + (minutes < 10 ? '0'+minutes : minutes) + ' ' + ampm;
        document.getElementById('clock').innerText = strTime;
    }

    /* --- Window Manager --- */
    function openProgram(key) {
        // Close Start Menu
        document.getElementById('start-menu').classList.remove('open');

        if (openWindows[key]) {
            restoreWindow(key);
            return;
        }

        const prog = programs[key];
        const id = key;
        highestZ++;
        windowOffset += 20;
        if(windowOffset > 100) windowOffset = 0;

        // Create Window
        const win = document.createElement('div');
        win.className = 'window active';
        win.id = `win-${id}`;
        win.style.zIndex = highestZ;
        win.style.top = (50 + windowOffset) + 'px';
        win.style.left = (50 + windowOffset) + 'px';
        
        // Adjust for Doom
        if(key === 'doom') {
            win.style.background = '#222';
            win.querySelector('.window-body')?.style.setProperty('padding', '0');
        }

        win.innerHTML = `
            <div class="title-bar" onmousedown="startDrag(event, '${id}')" ontouchstart="startDrag(event, '${id}')">
                <div class="title-text">
                    <i class="fas ${prog.icon}"></i>
                    <span>${prog.title}</span>
                </div>
                <div class="title-controls">
                    <div class="control-btn btn-min" onclick="minimizeWindow('${id}')">_</div>
                    <div class="control-btn btn-max" onclick="maximizeWindow('${id}')">□</div>
                    <div class="control-btn btn-close" onclick="closeWindow('${id}')">X</div>
                </div>
            </div>
            <div class="window-menu-bar">
                <div class="menu-item">Game</div>
                <div class="menu-item">Options</div>
                <div class="menu-item">Help</div>
            </div>
            <div class="window-body" style="${key==='doom' ? 'padding:0; overflow:hidden; background:#000;' : ''}">
                ${prog.content}
            </div>
        `;

        // Bring to front on click
        win.addEventListener('mousedown', () => focusWindow(id));
        
        document.getElementById('windows-container').appendChild(win);
        openWindows[id] = win;

        // Create Taskbar Item
        const taskItem = document.createElement('div');
        taskItem.className = 'task-item active';
        taskItem.id = `task-${id}`;
        taskItem.onclick = () => toggleMinimize(id);
        taskItem.innerHTML = `
            <i class="fas ${prog.icon}"></i>
            <span class="task-text">${prog.title}</span>
        `;
        document.getElementById('task-list').appendChild(taskItem);

        // --- Special Init for Games ---
        if(key === 'doom') {
            // Wait for DOM to render window content
            setTimeout(() => initDoomGame('doom-canvas'), 50);
        }
    }

    function closeWindow(id) {
        // Hook for doom
        if(id === 'doom') {
            stopDoomGame();
        }

        const win = document.getElementById(`win-${id}`);
        if (win) win.remove();
        
        const task = document.getElementById(`task-${id}`);
        if (task) task.remove();
        
        delete openWindows[id];
    }

    function minimizeWindow(id) {
        const win = document.getElementById(`win-${id}`);
        win.classList.add('minimized');
        win.classList.remove('active');
        document.getElementById(`task-${id}`).classList.remove('active');
    }

    function restoreWindow(id) {
        const win = document.getElementById(`win-${id}`);
        win.classList.remove('minimized');
        focusWindow(id);
    }

    function toggleMinimize(id) {
        const win = document.getElementById(`win-${id}`);
        if (win.classList.contains('minimized')) {
            restoreWindow(id);
        } else if (win.classList.contains('active')) {
            minimizeWindow(id);
        } else {
            focusWindow(id);
        }
    }

    function maximizeWindow(id) {
        const win = document.getElementById(`win-${id}`);
        win.classList.toggle('maximized');
        focusWindow(id);
        // Resize doom if max
        if(id === 'doom' && window.doomResize) window.doomResize();
    }

    function focusWindow(id) {
        highestZ++;
        const win = document.getElementById(`win-${id}`);
        if(!win) return;
        
        win.style.zIndex = highestZ;
        win.classList.add('active');
        win.classList.remove('minimized');
        
        // Update Taskbar
        document.querySelectorAll('.task-item').forEach(t => t.classList.remove('active'));
        const task = document.getElementById(`task-${id}`);
        if(task) task.classList.add('active');
        
        // Deactivate others visual
        Object.values(openWindows).forEach(w => {
            if(w.id !== `win-${id}`) w.classList.remove('active');
        });
    }

    function toggleStartMenu() {
        const menu = document.getElementById('start-menu');
        menu.classList.toggle('open');
        highestZ++;
        menu.style.zIndex = highestZ + 1; // Always on top
    }

    function triggerShutdown() {
        document.getElementById('start-menu').classList.remove('open');
        // Fade out effect
        document.body.style.transition = "opacity 1s";
        document.body.style.opacity = 0;
        setTimeout(() => {
            document.getElementById('bsod').style.display = 'block';
            document.body.style.opacity = 1;
        }, 1000);
    }

    /* --- Dragging Logic --- */
    let isDragging = false;
    let dragTarget = null;
    let dragOffsetX = 0;
    let dragOffsetY = 0;

    function startDrag(e, id) {
        if(e.target.closest('.control-btn')) return; 
        
        const win = document.getElementById(`win-${id}`);
        if(win.classList.contains('maximized')) return; 

        isDragging = true;
        dragTarget = win;
        focusWindow(id);

        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;

        const rect = win.getBoundingClientRect();
        dragOffsetX = clientX - rect.left;
        dragOffsetY = clientY - rect.top;
        
        // e.preventDefault(); // Removed to allow button clicking inside? No, keep for title bar
    }

    document.addEventListener('mousemove', (e) => {
        if (!isDragging || !dragTarget) return;
        moveWindow(e.clientX, e.clientY);
    });
    
    document.addEventListener('touchmove', (e) => {
        if (!isDragging || !dragTarget) return;
        moveWindow(e.touches[0].clientX, e.touches[0].clientY);
    }, {passive: false});

    function moveWindow(x, y) {
        let newX = x - dragOffsetX;
        let newY = y - dragOffsetY;
        if (newY < 0) newY = 0;
        dragTarget.style.left = newX + 'px';
        dragTarget.style.top = newY + 'px';
    }

    document.addEventListener('mouseup', () => {
        isDragging = false;
        dragTarget = null;
    });
    
    document.addEventListener('touchend', () => {
        isDragging = false;
        dragTarget = null;
    });

    /* =========================================================
       DOOM.EXE - RAYCASTING ENGINE
       ========================================================= */
    let doomInterval = null;
    let doomCtx = null;
    let doomCanvas = null;

    function initDoomGame(canvasId) {
        const canvas = document.getElementById(canvasId);
        if(!canvas) return;
        doomCanvas = canvas;
        doomCtx = canvas.getContext('2d');
        
        // Set resolution (low res for retro feel)
        const screenWidth = 320;
        const screenHeight = 200;
        canvas.width = screenWidth;
        canvas.height = screenHeight;

        // --- Game State ---
        const mapWidth = 16;
        const mapHeight = 16;
        // 1: Wall, 0: Empty, 2: Tech Pillar
        const worldMap = [
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,2,0,2,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,2,0,2,0,0,0,0,0,0,1],
            [1,0,0,2,2,0,0,0,0,0,2,2,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1],
            [1,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,0,2,0,0,0,0,0,0,0,2,0,0,0,1],
            [1,0,0,2,0,0,0,0,0,0,0,2,0,0,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ];

        let posX = 8, posY = 8;  // Player start
        let dirX = -1, dirY = 0; // Direction vector
        let planeX = 0, planeY = 0.66; // Camera plane

        let time = 0;
        let oldTime = 0;
        
        // Input
        let keys = { w: false, s: false, a: false, d: false, up: false, down: false, left: false, right: false };
        
        // Entities
        let bug = { x: 10.5, y: 10.5, alive: true };
        let shootTimer = 0;

        // --- Helpers ---
        const handleKeyDown = (e) => {
            if(e.key === "ArrowUp") keys.up = true;
            if(e.key === "ArrowDown") keys.down = true;
            if(e.key === "ArrowLeft") keys.left = true;
            if(e.key === "ArrowRight") keys.right = true;
            if(e.key === " ") fireGun();
        };
        const handleKeyUp = (e) => {
            if(e.key === "ArrowUp") keys.up = false;
            if(e.key === "ArrowDown") keys.down = false;
            if(e.key === "ArrowLeft") keys.left = false;
            if(e.key === "ArrowRight") keys.right = false;
        };

        document.addEventListener('keydown', handleKeyDown);
        document.addEventListener('keyup', handleKeyUp);

        // Touch Controls Binding
        const bindTouch = (id, key) => {
            const btn = document.getElementById(id);
            if(!btn) return;
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
            btn.addEventListener('mousedown', (e) => { keys[key] = true; });
            btn.addEventListener('mouseup', (e) => { keys[key] = false; });
        };

        bindTouch('doom-up', 'up');
        bindTouch('doom-down', 'down');
        bindTouch('doom-left', 'left');
        bindTouch('doom-right', 'right');
        
        const fireBtn = document.getElementById('doom-fire-btn');
        if(fireBtn) {
            fireBtn.addEventListener('touchstart', (e) => { e.preventDefault(); fireGun(); });
            fireBtn.addEventListener('mousedown', (e) => { fireGun(); });
        }

        function fireGun() {
            if(shootTimer > 0) return;
            shootTimer = 10; // Animation frames
            
            // Simple hit check (if facing bug)
            // Vector to bug
            const bugDirX = bug.x - posX;
            const bugDirY = bug.y - posY;
            const dist = Math.sqrt(bugDirX*bugDirX + bugDirY*bugDirY);
            // Normalize
            const bugNormX = bugDirX / dist;
            const bugNormY = bugDirY / dist;
            
            // Dot product with player dir
            const dot = dirX * bugNormX + dirY * bugNormY;
            
            if (dot > 0.8 && bug.alive && dist < 6) {
                bug.alive = false;
                setTimeout(() => alert("DEBUGGING COMPLETE! YOU SQUASHED THE BUG!"), 100);
            }
        }

        // --- Loop ---
        function gameLoop() {
            if (!doomCanvas.closest('body')) return; // Stop if removed

            // Clear Background (Ceiling/Floor)
            doomCtx.fillStyle = "#333"; // Ceiling
            doomCtx.fillRect(0, 0, screenWidth, screenHeight / 2);
            doomCtx.fillStyle = "#554433"; // Floor
            doomCtx.fillRect(0, screenHeight / 2, screenWidth, screenHeight / 2);

            // --- Raycasting ---
            const zBuffer = new Array(screenWidth).fill(0);

            for (let x = 0; x < screenWidth; x++) {
                let cameraX = 2 * x / screenWidth - 1;
                let rayDirX = dirX + planeX * cameraX;
                let rayDirY = dirY + planeY * cameraX;

                let mapX = Math.floor(posX);
                let mapY = Math.floor(posY);

                let sideDistX, sideDistY;
                
                let deltaDistX = Math.abs(1 / rayDirX);
                let deltaDistY = Math.abs(1 / rayDirY);
                let perpWallDist;

                let stepX, stepY;
                let hit = 0;
                let side;

                if (rayDirX < 0) {
                    stepX = -1;
                    sideDistX = (posX - mapX) * deltaDistX;
                } else {
                    stepX = 1;
                    sideDistX = (mapX + 1.0 - posX) * deltaDistX;
                }
                if (rayDirY < 0) {
                    stepY = -1;
                    sideDistY = (posY - mapY) * deltaDistY;
                } else {
                    stepY = 1;
                    sideDistY = (mapY + 1.0 - posY) * deltaDistY;
                }

                // DDA
                while (hit === 0) {
                    if (sideDistX < sideDistY) {
                        sideDistX += deltaDistX;
                        mapX += stepX;
                        side = 0;
                    } else {
                        sideDistY += deltaDistY;
                        mapY += stepY;
                        side = 1;
                    }
                    if (worldMap[mapX][mapY] > 0) hit = 1;
                }

                if (side === 0) perpWallDist = (mapX - posX + (1 - stepX) / 2) / rayDirX;
                else           perpWallDist = (mapY - posY + (1 - stepY) / 2) / rayDirY;
                
                zBuffer[x] = perpWallDist; // Store for sprites

                let lineHeight = Math.floor(screenHeight / perpWallDist);
                let drawStart = -lineHeight / 2 + screenHeight / 2;
                if (drawStart < 0) drawStart = 0;
                let drawEnd = lineHeight / 2 + screenHeight / 2;
                if (drawEnd >= screenHeight) drawEnd = screenHeight - 1;

                // Color
                let color = "#666";
                if (worldMap[mapX][mapY] === 2) color = "#0044aa"; // Blue Tech
                if (side === 1) {
                    // Darken side
                    let c = worldMap[mapX][mapY] === 2 ? [0, 50, 140] : [80, 80, 80];
                    color = `rgb(${c[0]}, ${c[1]}, ${c[2]})`;
                } else {
                    let c = worldMap[mapX][mapY] === 2 ? [0, 68, 170] : [120, 120, 120];
                    color = `rgb(${c[0]}, ${c[1]}, ${c[2]})`;
                }

                doomCtx.fillStyle = color;
                doomCtx.fillRect(x, drawStart, 1, drawEnd - drawStart);
            }

            // --- Sprite Rendering (The Bug) ---
            if (bug.alive) {
                const spriteX = bug.x - posX;
                const spriteY = bug.y - posY;
                
                // Inverse Camera Matrix
                const invDet = 1.0 / (planeX * dirY - dirX * planeY);
                const transformX = invDet * (dirY * spriteX - dirX * spriteY);
                const transformY = invDet * (-planeY * spriteX + planeX * spriteY);
                
                const spriteScreenX = Math.floor((screenWidth / 2) * (1 + transformX / transformY));
                
                // Calculate dimensions
                const spriteHeight = Math.abs(Math.floor(screenHeight / transformY));
                const spriteWidth = Math.abs(Math.floor(screenHeight / transformY));
                const spriteTop = Math.floor(-spriteHeight / 2 + screenHeight / 2);
                const spriteLeft = Math.floor(-spriteWidth / 2 + spriteScreenX);
                
                // Draw if in front and not behind wall
                if (transformY > 0 && spriteLeft > -spriteWidth && spriteLeft < screenWidth && transformY < zBuffer[spriteScreenX]) {
                     doomCtx.font = `${spriteHeight}px sans-serif`;
                     doomCtx.textAlign = 'center';
                     doomCtx.textBaseline = 'middle';
                     doomCtx.fillText('👾', spriteScreenX, screenHeight/2 + 10);
                }
            }

            // --- Weapon ---
            // Draw Shotgun
            const gunW = 120;
            const gunH = 100;
            const gunX = screenWidth / 2 - gunW / 2;
            const gunY = screenHeight - gunH + (Math.sin(time * 0.1) * 5); // Bobbing
            
            doomCtx.fillStyle = "#444";
            // Left barrel
            doomCtx.fillRect(gunX + 20, gunY, 30, gunH);
            // Right barrel
            doomCtx.fillRect(gunX + 70, gunY, 30, gunH);
            
            if (shootTimer > 0) {
                shootTimer--;
                // Muzzle flash
                doomCtx.fillStyle = `rgba(255, 200, 50, ${Math.random()})`;
                doomCtx.beginPath();
                doomCtx.arc(screenWidth/2, screenHeight/2 + 20, 40, 0, Math.PI*2);
                doomCtx.fill();
            }

            // --- Movement ---
            const moveSpeed = 0.1;
            const rotSpeed = 0.05;

            if (keys.up) {
                if(worldMap[Math.floor(posX + dirX * moveSpeed)][Math.floor(posY)] == 0) posX += dirX * moveSpeed;
                if(worldMap[Math.floor(posX)][Math.floor(posY + dirY * moveSpeed)] == 0) posY += dirY * moveSpeed;
            }
            if (keys.down) {
                if(worldMap[Math.floor(posX - dirX * moveSpeed)][Math.floor(posY)] == 0) posX -= dirX * moveSpeed;
                if(worldMap[Math.floor(posX)][Math.floor(posY - dirY * moveSpeed)] == 0) posY -= dirY * moveSpeed;
            }
            if (keys.right) {
                let oldDirX = dirX;
                dirX = dirX * Math.cos(-rotSpeed) - dirY * Math.sin(-rotSpeed);
                dirY = oldDirX * Math.sin(-rotSpeed) + dirY * Math.cos(-rotSpeed);
                let oldPlaneX = planeX;
                planeX = planeX * Math.cos(-rotSpeed) - planeY * Math.sin(-rotSpeed);
                planeY = oldPlaneX * Math.sin(-rotSpeed) + planeY * Math.cos(-rotSpeed);
            }
            if (keys.left) {
                let oldDirX = dirX;
                dirX = dirX * Math.cos(rotSpeed) - dirY * Math.sin(rotSpeed);
                dirY = oldDirX * Math.sin(rotSpeed) + dirY * Math.cos(rotSpeed);
                let oldPlaneX = planeX;
                planeX = planeX * Math.cos(rotSpeed) - planeY * Math.sin(rotSpeed);
                planeY = oldPlaneX * Math.sin(rotSpeed) + planeY * Math.cos(rotSpeed);
            }
            
            time++;
            doomInterval = requestAnimationFrame(gameLoop);
        }

        // Start loop
        doomInterval = requestAnimationFrame(gameLoop);
        
        // Store cleanup
        window.doomCleanup = () => {
            cancelAnimationFrame(doomInterval);
            document.removeEventListener('keydown', handleKeyDown);
            document.removeEventListener('keyup', handleKeyUp);
        };
        
        // Handle resize for canvas (simple)
        window.doomResize = () => {
            // Keeping internal resolution low for style
        };
    }

    function stopDoomGame() {
        if (window.doomCleanup) {
            window.doomCleanup();
            window.doomCleanup = null;
        }
    }

    // Initialize
    window.onload = initDesktop;

</script>
</body>
</html>